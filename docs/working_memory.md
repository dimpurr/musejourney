# MuseJourney 工作备忘录

随时更新最新工作进展和备忘到这个文档！！

## 已完成工作

1. **项目规划与文档**
   - [x] 项目概述文档 (`docs/project_overview.md`)
   - [x] 技术需求与选型文档 (`docs/technical_requirements.md`)
   - [x] 课程内容规划文档 (`docs/course_content.md`)
   - [x] UI/UX 设计规范文档 (`docs/ui_ux_design.md`)
   - [x] 更新主 README.md

2. **项目初始化**
   - [x] 使用 Next.js + TypeScript + Tailwind CSS 初始化项目
   - [x] 安装必要的依赖包 (Tone.js, Tonal.js, Vexflow, Framer Motion, Zustand)
   - [x] 创建基本项目结构

3. **核心功能开发**
   - [x] 定义音乐相关类型 (`src/types/music.ts`)
   - [x] 定义 Web MIDI API 类型 (`src/types/webmidi.d.ts`)
   - [x] 创建 MIDI 工具模块 (`src/lib/midi/midiAccess.ts`)
   - [x] 创建音频引擎模块 (`src/lib/audio/audioEngine.ts`)
   - [x] 创建音乐理论工具模块 (`src/lib/theory/musicTheory.ts`)
   - [x] 创建 MIDI 钩子 (`src/hooks/useMidi.ts`)

4. **基础 UI 开发**
   - [x] 更新应用布局 (`src/app/layout.tsx`)
   - [x] 创建首页 (`src/app/page.tsx`)
   - [x] 创建课程页面 (`src/app/courses/page.tsx`)
   - [x] 创建工具页面 (`src/app/tools/page.tsx`)
   - [x] 创建关于页面 (`src/app/about/page.tsx`)

5. **音乐可视化组件**
   - [x] 钢琴键盘组件 (`src/components/music/PianoKeyboard.tsx`)
   - [x] 和弦显示组件 (`src/components/music/ChordDisplay.tsx`)
   - [x] 音阶可视化组件 (`src/components/music/ScaleVisualizer.tsx`)
   - [x] 和声进行组件 (`src/components/music/ChordProgression.tsx`)
   - [x] 乐谱显示组件 (`src/components/music/MusicNotation.tsx`)

6. **交互式学习组件**
   - [x] 音程练习组件 (`src/components/training/IntervalTrainer.tsx`)
   - [x] 和弦识别组件 (`src/components/training/ChordIdentifier.tsx`)
   - [x] 和声分析组件 (`src/components/analysis/HarmonyAnalyzer.tsx`)

7. **工具功能开发**
   - [x] 和声分析工具 (`src/app/tools/harmony-analyzer/page.tsx`)
   - [x] 修改音频引擎使用合成器而非采样器
   - [x] 音程听辨训练工具页面 (`src/app/tools/interval-trainer/page.tsx`)
   - [x] 和弦听辨训练工具页面 (`src/app/tools/chord-identifier/page.tsx`)
   - [x] 和声进行听辨训练工具页面 (`src/app/tools/progression-ear-training/page.tsx`)

## 当前问题

1. **组件集成**
   - 需要将已创建的组件集成到课程页面中
   - 需要完善工具页面，添加更多工具

2. **用户体验优化**
   - 移动端适配需要优化
   - 需要添加更多的用户引导和帮助信息
   - 听力训练工具用户体验不佳：
     - 用户只能选择答案，无法回到上一题
     - 答错时不会自动显示正确答案
     - 和声进行训练中钢琴键盘没有正确显示音符变化
     - 缺乏进度保存和历史记录功能
     - 没有难度设置和自定义训练选项

3. **内容开发**
   - 课程内容需要进一步丰富
   - 需要添加更多的交互式练习

## 待办事项

### 1. 完善现有功能

- [ ] **优化组件交互**
  - 改进钢琴键盘组件的触摸支持
  - 优化和声分析工具的用户体验
  - 完善乐谱显示组件的交互功能

- [ ] **听力训练工具用户体验优化**
  - [ ] **创建共享的训练组件基础设施**
    - [ ] 创建 TrainingHistory 组件，用于显示历史答题记录
    - [ ] 创建 TrainingSettings 组件，用于自定义训练选项
    - [ ] 创建 TrainingProgress 组件，用于显示进度和统计信息
    - [ ] 实现 localStorage 存储机制，保存用户训练历史和设置
  
  - [ ] **音程听辨训练改进**
    - [ ] 添加"显示答案"按钮，自动显示正确答案
    - [ ] 添加"上一题"功能，允许用户回顾之前的题目
    - [ ] 添加难度设置（如限制特定音程类型）
    - [ ] 改进视觉反馈，在钢琴键盘上清晰显示音程
    - [ ] 添加解释说明，帮助用户理解为什么是特定音程
  
  - [ ] **和弦听辨训练改进**
    - [ ] 添加"显示答案"按钮，自动显示正确答案
    - [ ] 添加"上一题"功能，允许用户回顾之前的题目
    - [ ] 添加难度设置（如限制特定和弦类型）
    - [ ] 改进视觉反馈，在钢琴键盘上清晰显示和弦音符
    - [ ] 添加和弦结构解释，帮助用户理解和弦构成
  
  - [ ] **和声进行听辨训练改进**
    - [ ] 修复钢琴键盘视觉显示问题，确保正确显示和声进行中的音符变化
    - [ ] 添加"显示答案"按钮，自动显示正确答案
    - [ ] 添加"上一题"功能，允许用户回顾之前的题目
    - [ ] 添加难度设置（如限制特定和声进行类型）
    - [ ] 添加和声进行解释，帮助用户理解和声功能和特点
    - [ ] 实现逐个和弦播放功能，帮助用户更好地理解和声进行

  - [ ] **用户进度跟踪**
    - [ ] 实现训练会话记录，保存用户的训练历史
    - [ ] 创建进度统计页面，显示用户在不同训练类型中的表现
    - [ ] 添加成就系统，激励用户持续训练
    - [ ] 实现训练建议功能，基于用户表现推荐适合的训练内容

- [ ] **课程内容开发**
  - 创建基础乐理课程内容
  - 创建和声基础课程内容
  - 添加交互式练习

### 2. 核心组件开发

- [ ] **状态管理**
  - [ ] 创建全局状态管理 (使用 Zustand)
  - [ ] 实现用户进度跟踪
  - [ ] 实现设置管理

### 3. 课程内容开发

- [ ] **基础乐理模块**
  - [ ] 音符与记谱法课程
  - [ ] 音程课程
  - [ ] 音阶课程
  - [ ] 基础练习

- [ ] **和声基础模块**
  - [ ] 三和弦课程
  - [ ] 和弦连接课程
  - [ ] 调式和声课程
  - [ ] 和声练习

- [ ] **进阶和声模块**
  - [ ] 七和弦课程
  - [ ] 二次和声课程
  - [ ] 调性转换课程
  - [ ] 进阶练习

- [ ] **现代和声技术模块**
  - [ ] 扩展和声课程
  - [ ] 非功能和声课程
  - [ ] 爵士和声课程
  - [ ] 高级练习

### 4. 工具功能开发

- [ ] **创作辅助工具**
  - [ ] 和声进行生成器
  - [ ] 和声变奏工具
  - [ ] 和声模板库

- [ ] **听力训练工具页面**
  - [ ] 音程听辨训练页面
  - [ ] 和弦听辨训练页面
  - [ ] 和声进行听辨训练页面

### 5. 用户体验优化

- [ ] **响应式设计优化**
  - [ ] 确保在不同设备上的良好体验
  - [ ] 优化移动端交互

- [ ] **性能优化**
  - [ ] 代码分割
  - [ ] 资源懒加载
  - [ ] 减少不必要的重渲染

- [ ] **可访问性优化**
  - [ ] 键盘导航支持
  - [ ] 屏幕阅读器支持
  - [ ] 颜色对比度优化

### 6. 测试与部署

- [ ] **单元测试**
  - [ ] 音乐理论工具测试
  - [ ] 组件测试

- [ ] **集成测试**
  - [ ] 用户流程测试
  - [ ] 跨浏览器测试

- [ ] **部署**
  - [ ] 配置 Vercel 部署
  - [ ] 设置自定义域名
  - [ ] 配置 CI/CD 流程

## 详细任务分解

### 阶段 1: 完善现有功能与组件集成

#### 任务 1.1: 优化组件交互
1. 改进钢琴键盘组件的触摸支持
2. 优化和声分析工具的用户体验
3. 完善乐谱显示组件的交互功能
4. 测试各组件在不同设备上的表现

#### 任务 1.2: 完善工具页面
1. 实现音程听辨训练工具页面
2. 实现和弦听辨训练工具页面
3. 添加更多工具选项
4. 优化工具页面的导航和布局

#### 任务 1.3: 课程内容开发
1. 创建基础乐理课程内容
2. 创建和声基础课程内容
3. 添加交互式练习
4. 实现课程进度跟踪

### 阶段 2: 开发高级功能与内容

#### 任务 2.1: 状态管理
1. 创建全局状态管理 (使用 Zustand)
2. 实现用户进度跟踪
3. 实现设置管理
4. 测试状态管理功能

#### 任务 2.2: 创作辅助工具
1. 创建和声进行生成器
2. 创建和声变奏工具
3. 创建和声模板库
4. 测试工具功能

#### 任务 2.3: 听力训练工具页面
1. 创建音程听辨训练页面
2. 创建和弦听辨训练页面
3. 创建和声进行听辨训练页面
4. 实现进度跟踪和评分系统

### 阶段 3: 用户体验优化与测试

#### 任务 3.1: 响应式设计优化
1. 检查所有组件在不同屏幕尺寸上的表现
2. 优化移动端布局和交互
3. 测试不同设备上的用户体验

#### 任务 3.2: 性能优化
1. 实现代码分割
2. 优化资源加载
3. 减少不必要的重渲染
4. 性能测试与优化

#### 任务 3.3: 可访问性优化
1. 添加键盘导航支持
2. 确保屏幕阅读器支持
3. 检查颜色对比度
4. 可访问性测试

#### 任务 3.4: 测试与部署
1. 编写单元测试
2. 进行集成测试
3. 配置 Vercel 部署
4. 设置自定义域名

## 重要参考资料

1. **音乐理论参考**
   - [Music Theory Online](https://www.musictheory.net/)
   - [Open Music Theory](http://openmusictheory.com/)
   - [Teoria.js 文档](https://github.com/saebekassebil/teoria)

2. **技术文档**
   - [Tone.js 文档](https://tonejs.github.io/)
   - [Tonal.js 文档](https://github.com/tonaljs/tonal)
   - [Vexflow 文档](https://github.com/0xfe/vexflow)
   - [Web MIDI API 规范](https://webaudio.github.io/web-midi-api/)

3. **设计参考**
   - [Ableton Learning Music](https://learningmusic.ableton.com/)
   - [Teoria.js 演示](https://teoria.github.io/demos/)
   - [Hooktheory](https://www.hooktheory.com/)

## 注意事项

1. **浏览器兼容性**
   - Web MIDI API 并非所有浏览器都支持
   - 需要添加浏览器兼容性检查和降级方案

2. **性能考虑**
   - 音频处理可能占用大量资源
   - 需要优化音频加载和处理
   - 考虑使用 Web Workers 进行复杂计算

3. **用户体验**
   - 确保提供清晰的用户引导
   - 添加适当的加载状态和错误处理
   - 提供详细的帮助文档

## 下一步工作

1. 创建音程听辨训练工具页面
2. 创建和弦听辨训练工具页面
3. 优化移动端适配
4. 开始开发课程内容 