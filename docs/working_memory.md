# MuseJourney 工作备忘录

随时更新最新工作进展和备忘到这个文档！！

## 已完成工作

1. **项目规划与文档**
   - [x] 项目概述文档 (`docs/project_overview.md`)
   - [x] 技术需求与选型文档 (`docs/technical_requirements.md`)
   - [x] 课程内容规划文档 (`docs/course_content.md`)
   - [x] UI/UX 设计规范文档 (`docs/ui_ux_design.md`)
   - [x] 更新主 README.md

2. **项目初始化**
   - [x] 使用 Next.js + TypeScript + Tailwind CSS 初始化项目
   - [x] 安装必要的依赖包 (Tone.js, Tonal.js, Vexflow, Framer Motion, Zustand)
   - [x] 创建基本项目结构

3. **核心功能开发**
   - [x] 定义音乐相关类型 (`src/types/music.ts`)
   - [x] 定义 Web MIDI API 类型 (`src/types/webmidi.d.ts`)
   - [x] 创建 MIDI 工具模块 (`src/lib/midi/midiAccess.ts`)
   - [x] 创建音频引擎模块 (`src/lib/audio/audioEngine.ts`)
   - [x] 创建音乐理论工具模块 (`src/lib/theory/musicTheory.ts`)
   - [x] 创建 MIDI 钩子 (`src/hooks/useMidi.ts`)

4. **基础 UI 开发**
   - [x] 更新应用布局 (`src/app/layout.tsx`)
   - [x] 创建首页 (`src/app/page.tsx`)

## 当前问题

1. **音频样本缺失**
   - 控制台显示多个 404 错误，缺少钢琴音频样本文件
   - 需要下载并添加钢琴样本到 `/public/samples/piano/` 目录

2. **页面路由缺失**
   - 导航栏中的"课程"、"工具"和"关于"页面尚未创建
   - 访问这些路径时返回 404 错误

3. **钢琴键盘组件**
   - 尝试创建钢琴键盘组件但未成功实现

## 待办事项

### 1. 修复当前问题

- [ ] **添加钢琴音频样本**
  - 下载钢琴样本文件
  - 创建 `/public/samples/piano/` 目录
  - 添加所有必要的音频文件 (A0.mp3, C1.mp3, Ds1.mp3 等)
  - 或者修改音频引擎使用内置合成器而非采样器

- [ ] **创建缺失的页面路由**
  - 创建 `/courses` 页面
  - 创建 `/tools` 页面
  - 创建 `/about` 页面

- [ ] **完成钢琴键盘组件**
  - 重新实现 `PianoKeyboard.tsx` 组件
  - 确保键盘可视化和交互功能正常工作

### 2. 核心组件开发

- [ ] **音乐可视化组件**
  - [ ] 和弦显示组件 (`ChordDisplay.tsx`)
  - [ ] 音阶可视化组件 (`ScaleVisualizer.tsx`)
  - [ ] 和声进行组件 (`ChordProgression.tsx`)
  - [ ] 乐谱显示组件 (使用 Vexflow)

- [ ] **交互式学习组件**
  - [ ] 音程练习组件 (`IntervalTrainer.tsx`)
  - [ ] 和弦识别组件 (`ChordIdentifier.tsx`)
  - [ ] 和声分析组件 (`HarmonyAnalyzer.tsx`)

- [ ] **状态管理**
  - [ ] 创建全局状态管理 (使用 Zustand)
  - [ ] 实现用户进度跟踪
  - [ ] 实现设置管理

### 3. 课程内容开发

- [ ] **基础乐理模块**
  - [ ] 音符与记谱法课程
  - [ ] 音程课程
  - [ ] 音阶课程
  - [ ] 基础练习

- [ ] **和声基础模块**
  - [ ] 三和弦课程
  - [ ] 和弦连接课程
  - [ ] 调式和声课程
  - [ ] 和声练习

- [ ] **进阶和声模块**
  - [ ] 七和弦课程
  - [ ] 二次和声课程
  - [ ] 调性转换课程
  - [ ] 进阶练习

- [ ] **现代和声技术模块**
  - [ ] 扩展和声课程
  - [ ] 非功能和声课程
  - [ ] 爵士和声课程
  - [ ] 高级练习

### 4. 工具功能开发

- [ ] **和声分析工具**
  - [ ] 和弦识别工具
  - [ ] 和声进行分析工具
  - [ ] 调性分析工具

- [ ] **创作辅助工具**
  - [ ] 和声进行生成器
  - [ ] 和声变奏工具
  - [ ] 和声模板库

- [ ] **听力训练工具**
  - [ ] 音程听辨训练
  - [ ] 和弦听辨训练
  - [ ] 和声进行听辨训练

### 5. 用户体验优化

- [ ] **响应式设计优化**
  - [ ] 确保在不同设备上的良好体验
  - [ ] 优化移动端交互

- [ ] **性能优化**
  - [ ] 代码分割
  - [ ] 资源懒加载
  - [ ] 减少不必要的重渲染

- [ ] **可访问性优化**
  - [ ] 键盘导航支持
  - [ ] 屏幕阅读器支持
  - [ ] 颜色对比度优化

### 6. 测试与部署

- [ ] **单元测试**
  - [ ] 音乐理论工具测试
  - [ ] 组件测试

- [ ] **集成测试**
  - [ ] 用户流程测试
  - [ ] 跨浏览器测试

- [ ] **部署**
  - [ ] 配置 Vercel 部署
  - [ ] 设置自定义域名
  - [ ] 配置 CI/CD 流程

## 详细任务分解

### 阶段 1: 修复基础问题与完善核心功能

#### 任务 1.1: 添加钢琴音频样本
1. 研究可用的免费钢琴样本库
2. 下载并处理音频文件，确保格式一致
3. 创建 `/public/samples/piano/` 目录
4. 添加所有必要的音频文件
5. 测试音频加载和播放

#### 任务 1.2: 创建缺失的页面路由
1. 创建 `/app/courses/page.tsx`
2. 创建 `/app/tools/page.tsx`
3. 创建 `/app/about/page.tsx`
4. 确保导航链接正常工作

#### 任务 1.3: 完成钢琴键盘组件
1. 重新实现 `PianoKeyboard.tsx` 组件
2. 实现键盘渲染逻辑
3. 实现鼠标交互
4. 实现 MIDI 输入支持
5. 添加高亮和动画效果
6. 测试组件功能

### 阶段 2: 开发核心音乐可视化组件

#### 任务 2.1: 和弦显示组件
1. 创建 `ChordDisplay.tsx` 组件
2. 实现和弦可视化
3. 添加和弦播放功能
4. 添加和弦信息显示

#### 任务 2.2: 音阶可视化组件
1. 创建 `ScaleVisualizer.tsx` 组件
2. 实现音阶可视化
3. 添加音阶播放功能
4. 添加音阶信息显示

#### 任务 2.3: 和声进行组件
1. 创建 `ChordProgression.tsx` 组件
2. 实现和声进行可视化
3. 添加和声进行播放功能
4. 添加和声进行分析功能

#### 任务 2.4: 乐谱显示组件
1. 研究 Vexflow API
2. 创建 `MusicNotation.tsx` 组件
3. 实现基本乐谱渲染
4. 添加交互功能

### 阶段 3: 开发课程内容与学习路径

#### 任务 3.1: 课程结构设计
1. 设计课程数据模型
2. 创建课程内容 JSON 文件
3. 实现课程导航组件

#### 任务 3.2: 基础乐理模块
1. 创建音符与记谱法课程内容
2. 创建音程课程内容
3. 创建音阶课程内容
4. 开发交互式练习

#### 任务 3.3: 和声基础模块
1. 创建三和弦课程内容
2. 创建和弦连接课程内容
3. 创建调式和声课程内容
4. 开发交互式练习

#### 任务 3.4: 进阶和声模块
1. 创建七和弦课程内容
2. 创建二次和声课程内容
3. 创建调性转换课程内容
4. 开发交互式练习

#### 任务 3.5: 现代和声技术模块
1. 创建扩展和声课程内容
2. 创建非功能和声课程内容
3. 创建爵士和声课程内容
4. 开发交互式练习

### 阶段 4: 开发工具功能

#### 任务 4.1: 和声分析工具
1. 创建和弦识别工具
2. 创建和声进行分析工具
3. 创建调性分析工具
4. 测试工具功能

#### 任务 4.2: 创作辅助工具
1. 创建和声进行生成器
2. 创建和声变奏工具
3. 创建和声模板库
4. 测试工具功能

#### 任务 4.3: 听力训练工具
1. 创建音程听辨训练
2. 创建和弦听辨训练
3. 创建和声进行听辨训练
4. 实现进度跟踪和评分系统

### 阶段 5: 用户体验优化与测试

#### 任务 5.1: 响应式设计优化
1. 检查所有组件在不同屏幕尺寸上的表现
2. 优化移动端布局和交互
3. 测试不同设备上的用户体验

#### 任务 5.2: 性能优化
1. 实现代码分割
2. 优化资源加载
3. 减少不必要的重渲染
4. 性能测试与优化

#### 任务 5.3: 可访问性优化
1. 添加键盘导航支持
2. 确保屏幕阅读器支持
3. 检查颜色对比度
4. 可访问性测试

#### 任务 5.4: 测试与部署
1. 编写单元测试
2. 进行集成测试
3. 配置 Vercel 部署
4. 设置自定义域名

## 重要参考资料

1. **音乐理论参考**
   - [Music Theory Online](https://www.musictheory.net/)
   - [Open Music Theory](http://openmusictheory.com/)
   - [Teoria.js 文档](https://github.com/saebekassebil/teoria)

2. **技术文档**
   - [Tone.js 文档](https://tonejs.github.io/)
   - [Tonal.js 文档](https://github.com/tonaljs/tonal)
   - [Vexflow 文档](https://github.com/0xfe/vexflow)
   - [Web MIDI API 规范](https://webaudio.github.io/web-midi-api/)

3. **设计参考**
   - [Ableton Learning Music](https://learningmusic.ableton.com/)
   - [Teoria.js 演示](https://teoria.github.io/demos/)
   - [Hooktheory](https://www.hooktheory.com/)

## 注意事项

1. **音频样本问题**
   - 当前音频引擎配置为使用钢琴采样器，但缺少样本文件
   - 可以考虑两种解决方案:
     - 下载并添加钢琴样本文件
     - 修改音频引擎使用合成器而非采样器

2. **浏览器兼容性**
   - Web MIDI API 并非所有浏览器都支持
   - 需要添加浏览器兼容性检查和降级方案

3. **性能考虑**
   - 音频处理可能占用大量资源
   - 需要优化音频加载和处理
   - 考虑使用 Web Workers 进行复杂计算

4. **用户体验**
   - 确保提供清晰的用户引导
   - 添加适当的加载状态和错误处理
   - 提供详细的帮助文档

## 下一步工作

1. 添加钢琴音频样本或修改音频引擎使用合成器
2. 创建缺失的页面路由
3. 完成钢琴键盘组件
4. 开始开发核心音乐可视化组件 